<section class="projects">
  <div class="container">
    <h1 class="page-title">Unsere Projekte</h1>
    <p class="intro">Entdecken Sie eine Auswahl unserer realisierten Projekte. Jedes Stück ist ein Unikat, gefertigt mit Liebe zum Detail und höchster handwerklicher Präzision.</p>
    
    <div class="project-filters">
      <button class="filter-btn" [class.active]="activeFilter === 'all'" (click)="filterProjects('all')">Alle</button>
      <button class="filter-btn" [class.active]="activeFilter === 'moebel'" (click)="filterProjects('moebel')">Möbel</button>
      <button class="filter-btn" [class.active]="activeFilter === 'innenausbau'" (click)="filterProjects('innenausbau')">Innenausbau</button>
      <button class="filter-btn" [class.active]="activeFilter === 'restaurierung'" (click)="filterProjects('restaurierung')">Restaurierung</button>
    </div>

    <div class="project-grid">
      <div class="project-card" *ngFor="let project of filteredProjects" (click)="openProjectDetails(project)">
        <div class="project-image">
          <img [src]="project.images[0].imageUrl" [alt]="project.title">
          <div class="image-count" *ngIf="project.images.length > 1">
            +{{ project.images.length - 1 }}
          </div>
        </div>
        <div class="project-info">
          <h3>{{ project.title }}</h3>
          <p [class.truncated]="truncateText(project.description, 150).isTruncated">
            {{ truncateText(project.description, 150).text }}
          </p>
          <span class="category">{{ project.category }}</span>
          <button 
            *ngIf="authService.isAuthenticated() | async" 
            class="delete-btn" 
            (click)="deleteProject(project, $event)"
            title="Projekt löschen">
            <img src="assets/images/trashcan.png" alt="Löschen">
          </button>
        </div>
      </div>
    </div>
  </div>
</section>

<!-- Modal für Projektdetails -->
<div class="project-modal" *ngIf="selectedProject" (click)="closeProjectDetails()">
  <div class="modal-content" (click)="$event.stopPropagation()">
    <button class="close-btn" (click)="closeProjectDetails()">&times;</button>
    <div class="modal-gallery">
      <div class="gallery-main">
        <button class="gallery-nav prev" *ngIf="currentImageIndex > 0" (click)="previousImage()">&lt;</button>
        <img [src]="selectedProject.images[currentImageIndex].imageUrl" [alt]="selectedProject.title">
        <button class="gallery-nav next" *ngIf="currentImageIndex < selectedProject.images.length - 1" (click)="nextImage()">&gt;</button>
      </div>
      <div class="gallery-thumbnails" *ngIf="selectedProject.images.length > 1">
        <div 
          class="thumbnail" 
          *ngFor="let image of selectedProject.images; let i = index"
          [class.active]="i === currentImageIndex"
          (click)="setCurrentImage(i)">
          <img [src]="image.imageUrl" [alt]="selectedProject.title + ' Thumbnail ' + (i + 1)">
        </div>
      </div>
    </div>
    <div class="modal-info">
      <h2>{{ selectedProject.title }}</h2>
      <p class="category">{{ selectedProject.category }}</p>
      <p class="description">{{ selectedProject.description }}</p>
      <div class="details">
        <p><strong>Fertigstellung:</strong> {{ formatDate(selectedProject.completionDate) }}</p>
      </div>
    </div>
  </div>
</div>
